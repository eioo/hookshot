#!/usr/bin/env node
const fs = require('fs');
const path = require('path');
const program = require('commander');

program
  .version(JSON.parse(fs.readFileSync(path.join(__dirname, '../package.json'), 'utf-8')).version)
  .usage('<command>')
  .option('-p, --port <n>', 'Port number to listen to (defaults to 3000)', parseInt)
  .option('-r, --ref <refs>', 'Ref to look for (defaults to all refs)')
  .option('-wp, --webhook-path <path>', 'Path for webhook (defaults to /)')
  .option('-s, --start', 'Run action on start')
  .parse(process.argv);

const hookshot = require('../lib');

if (program.args.length == 0) {
  program.help();
}

const port = program.port || 3000;

hookshot(
    program.ref || 'hook',
    program.path || '/',
    program.start || false,
    program.args.join(' ')
  ).listen(port, () => {
  console.log(`Hookshotted to port ${port}`);
});


